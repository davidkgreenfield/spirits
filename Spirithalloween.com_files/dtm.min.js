(function(){function f(){window.digitalData=window.digitalData?window.digitalData:{};this.init()}$.extend(f.prototype,{init:function(){var a=this;this.debug=!1;this.setProductFindMethod();this.setupHandleUnloadCookie();this.getCommands();$(function(){a.checkFormTracking();a.checkSearchTracking()})},track:function(a){this.debug&&console.log("dtmManager.track",a,arguments.callee.caller);try{_satellite.track(a)}catch(c){this.debug&&console.log("ERROR dtmManager.track","_sattelite.track not fired.")}},
commands:[],productFindMethod:!1,updateData:function(a){$.extend(!0,window.digitalData,a)},setupHandleUnloadCookie:function(){var a=window.onunload;window.onunload=function(){docCookies.setItem("jsDTMCampaignTrkSession","true",120,"/");null!=a&&"function"==typeof a&&a.apply(window,arguments)}},setProductFindMethod:function(){var a=this.getQueryParam("inex").toLowerCase(),c=docCookies.getItem("jsDTMCampaignTrk"),b="true"==docCookies.getItem("jsDTMCampaignTrkSession"),e=""!=this.getQueryParam("Search");
null!=c&&b&&""==a&&(a=c);b||docCookies.removeItem("jsDTMCampaignTrk","/");e&&(a="s");""==a&&(a="b");switch(a){case "i":docCookies.setItem("jsDTMCampaignTrk",a,null,"/");a="internal campaign";break;case "e":docCookies.setItem("jsDTMCampaignTrk",a,null,"/");a="external campaign";break;case "s":a="internal search";break;default:a="browse"}this.productFindMethod=a},setVariable:function(a,c){var b={};this.processPath(a).reduce(function(e,d,g,h){e[d]||(e[d]={});g==h.length-1&&(e[d]=c);return e[d]},b);this.updateData(b)},
deleteVariable:function(a){a=this.processPath(a);var c=window.digitalData,b;for(b=0;b<a.length;b+=1)c[a[b]]&&(b==a.length-1?delete c[a[b]]:c=c[a[b]])},getVariable:function(a){a=this.processPath(a);var c=window.digitalData,b;for(b=0;b<a.length;b+=1)if(c[a[b]]){if(b==a.length-1)return c[a[b]];c=c[a[b]]}return!1},processPath:function(a){a=a.split(".");"digitaldata"==a[0].toLowerCase()&&a.splice(0,1);return a},buildQueryMap:function(a){a=a?a.replace("?","").split("&"):window.location.search.replace("?",
"").split("&");var c={},b;for(b=0;b<a.length;b+=1){var e=a[b].split("=");c[e[0]]=e[1]}return c},getQueryParam:function(a){this.queryMap||(this.queryMap=this.buildQueryMap());return this.queryMap[a]?this.queryMap[a]:""},trackPage:function(a,c,b,e){e=e?e:"";c=c?c:"";a=a?a:"";b=b?b:"";var d=[];""!=a&&d.push(a);""!=c&&d.push(c);""!=b&&d.push(b);""!=e&&d.push(e);dtmManager.setVariable("page.pageInfo.pageName",d.join(":"));dtmManager.setVariable("page.category",{channel:1<=d.length?d[0]:"n/a",subSection1:2<=
d.length?d.slice(0,2).join(":"):"n/a",subSection2:3<=d.length?d.slice(0,3).join(":"):"n/a",subSection3:4<=d.length?d.slice(0,4).join(":"):"n/a",subSection4:"n/a",subSection5:"n/a"})},getFormErrors:function(a){return $(a).find(".common-error").text().replace(/\./g,". ").replace(/  /g," ").trim()},startSearchTracking:function(a){jsonString=JSON.stringify({searchTerm:a});docCookies.setItem("jsDTMSearchTrk",jsonString,120,"/")},checkSearchTracking:function(){var a=docCookies.getItem("jsDTMSearchTrk");
if(null!=a){if(!this.getVariable("page.pageInfo.SearchResults"))try{a=JSON.parse(a),dtmManager.setVariable("link.searchRedirect",a.searchTerm),this.track("search redirect")}catch(c){}docCookies.removeItem("jsDTMSearchTrk","/")}},startFormTracking:function(a){a=$.extend(!0,{formName:"",formSelector:"",commands:[]},a);dtmManager.setVariable("link.formName",a.formName);this.track("form tracking");jsonString=JSON.stringify(a);docCookies.setItem("jsDTMFormTrk",jsonString,120,"/")},checkFormTracking:function(){var a=
docCookies.getItem("jsDTMFormTrk");if(null!=a){try{a=JSON.parse(a);dtmManager.setVariable("link.formName",a.formName);var c=$(a.formSelector);if(c.length){var b=this.getFormErrors(c);b.length&&this.setVariable("link.formError",b)}this.track("form tracking");setTimeout(function(){dtmManager.deleteVariable("link.formError")},1E3)}catch(e){}docCookies.removeItem("jsDTMFormTrk","/")}},getCommands:function(){var a=docCookies.getItem("jsDTMFormTrk"),c;if(null!=a)try{a=JSON.parse(a),this.commands=c=a.commands}catch(b){}},
extractDomain:function(a){a=-1<a.indexOf("://")?a.split("/")[2]:a.split("/")[0];return a=a.split(":")[0]}});window.dtmManager=new f})();
